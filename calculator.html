<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Arvo:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="css/main.css">

    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <title>WellSCAN Calculator - Calculate HER Rankings</title>
  </head>
  <body>
    <nav class="navbar navbar-light">
        <span class="navbar-brand mb-0 h1"><img src="img/wellscan_branding.png"></span>
    </nav>
    <!-- <section class="container-fluid calc header-calc">
        <div class="container">
            <h1>Calculate Rankings</h1>
        </div>
    </section> -->

    <section class="container calc">
        

        <form method="POST" action="#" id="calc-form" class="calc-form">
            <div class="calc-sec">
                <h3>Category</h3>
                <div class="row">
                    <div class="radio">
                        <input type="radio" name='foodType' id="fruitVeg" value="fruit-vegetable">
                        <label for="fruitVeg" id="fruitVeg">Fruit / Vegetable</label>
                    </div>
    
                    <div class="radio">
                        <input type="radio" name='foodType' id="protein" value="protein">
                        <label for="protein" id="protein">Protein</label>
                    </div>
    
                    <div class="radio">
                        <input type="radio" name='foodType' id="dairy" value="dairy">
                        <label for="dairy" id="dairy">Dairy</label>
                    </div>
    
                    <div class="radio">
                        <input type="radio" name='foodType' id="nonDairy" value="non-dairy-alternative">
                        <label for="nonDairy" id="nonDairy">Non-Dairy Alternative</label>
                    </div>
    
                    <div class="radio">
                        <input type="radio" name='foodType' id="beverage" value="beverage">
                        <label for="beverage" id="beverage">Beverage</label>
                    </div>
    
                    <div class="radio">
                        <input type="radio" name='foodType' id="mixedDish" value="mixed-dish">
                        <label for="mixedDish" id="mixedDish">Mixed Dish</label>
                    </div>
    
                    <div class="radio">
                        <input type="radio" name='foodType' id="processedPackage" value="snack-whole-grain">
                        <label for="processedPackage" id="processedPackage">Whole Grain Snack</label>
                    </div>
    
                    <!-- <div class="radio">
                        <input type="radio" name='foodType' id="dessert" value="dessert">
                        <label for="dessert" id="dessert">Dessert</label>
                    </div> -->

                    <div class="radio">
                        <input type="radio" name='foodType' id="grainWhole" value="grain-whole">
                        <label for="grainWhole" id="grainWhole">Whole Grain</label>
                    </div>

                    <div class="radio">
                        <input type="radio" name='foodType' id="grainReg" value="grain">
                        <label for="grainReg" id="grainReg">Non-Whole Grain</label>
                    </div>

                    </div>
            </div>
                
                <div class="calc-sec">

                    <div class="nutrition-div">
                        <p>Saturated Fat (g)</p>
                        <div class="textbox">
                            <input pattern="[0-9]*"  placeholder="Enter amount" inputmode="numeric" type="number" name='satfat' id="satfat">
                        </div>
                    </div>

                    <div class="nutrition-div">
                        <p>Sodium (mg)</p>
                        <div class="textbox">
                            <input pattern="[0-9]*" placeholder="Enter amount" inputmode="numeric" type="number" name='sodium' id="sodium">
                        </div>
                    </div>

                    <div class="nutrition-div">
                        <p><select id="sugarType"><option value="added" selected>Added</option><option value="total">Total</option></option></select> Sugars (g)</p>
    
                        <div class="textbox">
                            <input pattern="[0-9]*"  placeholder="Enter amount" inputmode="numeric" type="number" name='sugars' id="sugars">
                        </div>
                    </div>

                    <div class="nutrition-div">
                        <p>Rank</p>
                        <div class="textbox">
                            <span id="result" class="d-none badge">choose <span  id="rank"></span></span>
                        </div>
                    </div>
    
                    <!-- <h3>Added Sugars</h3>
                    <div class="row">
                        <div class="textbox">
                            <input pattern="[0-9]*" placeholder="Enter amount" inputmode="numeric" type="number" name='sugar' id="sugar" >
                        </div>
                    </div> -->
                </div>
                <button class="btn btn-block btn-primary" type="submit">calculate</button>
                <button id="btn_reset" class="btn btn-block btn-outline-secondary" type='reset"'>reset</button>
        </form>
    </section>




    <!-- Optional JavaScript -->
    <script src="main.js"></script>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
      

      var form = document.querySelector("#calc-form");
      var result = document.querySelector("#result");
      var rankElement= document.querySelector("#rank");
      var catRadios = document.querySelectorAll("[name='foodType']");
      var btn_reset = document.querySelector("#btn_reset");
      var input_sugar_type = document.querySelector("#sugarType");
      var sugarType = "added";

      window.addEventListener('DOMContentLoaded', (event) => {
            form.scrollIntoView();
      });

      btn_reset.addEventListener('click', function(e) {
          e.preventDefault();
          result.classList.add("d-none");
            rankElement.innerHTML="";
          form.reset();
      })

      input_sugar_type.addEventListener("change", function() {
        sugarType = this.value;
        console.log(sugarType);
      });

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        console.log("Submitted");
        result.classList.add("d-none");
        
        let category = e.target.elements.foodType.value;
        let sugars, added_sugars;

        if(sugarType == "added") {
            added_sugars = e.target.elements.sugars.value;
            sugars = 0;
        } 

        if (sugarType == "total") {
            added_sugars = 0;
            sugars = e.target.elements.sugars.value;
        }

        


        let satfat = e.target.elements.satfat.value;
        let sodium = e.target.elements.sodium.value;


        let endpoint = "http://localhost:8000/api/foods/rankFromNuts/" + category + "/" + satfat + "/" + sodium + "/" + added_sugars + "/" + sugars;
        console.log(endpoint);
        fetch(endpoint)
        .then(
            function(response) {
            if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' +
                response.status);
                return;
            }

            // Examine the text in the response
            response.json().then(function(data) {
                updateRankDisplay(data.rank);
            });
            }
        )
        .catch(function(err) {
            console.log('Fetch Error :-S', err);
        });
      });

      function updateRankDisplay(rank) {

        result.classList.remove('badge--often');
        result.classList.remove('badge--rarely');
        result.classList.remove('badge--sometimes');
        result.classList.remove("d-none");
        rankElement.innerHTML = rank;
        result.classList.add(`badge--${rank}`);

      }

      catRadios.forEach(function(el){
        el.addEventListener("click", function() {
          
            result.classList.add("d-none");
            rankElement.innerHTML="";
        });
      });
      
    </script>
  </body>
</html>